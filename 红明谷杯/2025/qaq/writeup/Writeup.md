# qaq

本题基于BLS12-381曲线上的Weil pairing，因为BLS12-381上的配对比较容易计算。

对于BLS12-381曲线使用的素数p，res中的素数实际上是在$[p-2^{12}, p+2^{12})$范围内的所有素数。

本题在加密时先取了曲线阶$n$的因子$qwq$，随后将flag每两字节分块，对于每个分块，计算$e(qaq*Q_1,qaq*Q_2)$，其中$qaq=n//(qwq^2)$,$e$为配对函数，$Q_1,Q_2$是曲线上的随机点。如果对曲线的order分解一下质因数。不难发现：

![order的结构](../assets/image.png)

因为椭圆曲线上的所有点在加法下构成一个群，所以由拉格朗日定理可以知道每个点的阶一定是曲线的阶的因数——也就是说，对于$qaq*Q_1$，一定有

$$qwq*qaq*Q_1=O$$

其中O为椭圆曲线的单位元。

我们称曲线上的$r-torsion$为所有满足$r*P=O$的P点形成的集合，其中O点为曲线的单位元。那么上面的等式说明$qaq*Q_1$和$qaq*Q_2$都是$qwq-torsion$里的点。而双线性配对存在一个性质：对$r-torsion$中的点的配对，配对到的值均为曲线所在域的$r$次单位根

也就是说，对于加密时每一个`out`,都有
$$\begin{align}
out^{qwq}\equiv c^{qwq*qaq}\bmod{p}\\
\end{align}$$
(因为$p|pp$，并且配对得到的值为单位根)

而c的取值是两个字节，处在可爆破范围内，因此我们对每个c遍历验证是否符合等式(1)即可求出符合题意的c，拼接即得flag。





